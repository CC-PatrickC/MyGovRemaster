<form id="requestEditForm" method="post" action="{% url 'edit_request' request_obj.id %}">
    {% csrf_token %}
    
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.title.id_for_label }}">Title</label>
            {{ form.title }}
            {% if form.title.errors %}
                <div class="error-message">{{ form.title.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.description.id_for_label }}">Description</label>
            {{ form.description }}
            {% if form.description.errors %}
                <div class="error-message">{{ form.description.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.department.id_for_label }}">Department</label>
            {{ form.department }}
            {% if form.department.errors %}
                <div class="error-message">{{ form.department.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.stage.id_for_label }}">Stage</label>
            {{ form.stage }}
            {% if form.stage.errors %}
                <div class="error-message">{{ form.stage.errors }}</div>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.request_type.id_for_label }}">Request Type</label>
            {{ form.request_type }}
            {% if form.request_type.errors %}
                <div class="error-message">{{ form.request_type.errors }}</div>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.priority.id_for_label }}">Priority</label>
            {{ form.priority }}
            {% if form.priority.errors %}
                <div class="error-message">{{ form.priority.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group full-width">
            <label>Attachments</label>
            <div class="file-upload-area" id="fileUploadArea" data-request-id="{{ request_obj.id }}">
                <input type="file" id="fileInput" multiple style="display: none;" />
                <div class="file-upload-content">
                    <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <p class="upload-text">Drag and drop files here or <span class="upload-link">click to browse</span></p>
                    <p class="upload-hint">You can upload up to 5 files. Maximum file size: 10MB each</p>
                </div>
            </div>
            <div class="attachments-section">
                <h4 class="attachments-section-title">Current Attachments</h4>
                <div class="attachments-list" id="attachmentsList">
                    {% if attachments %}
                        {% for attachment in attachments %}
                            <div class="attachment-item" data-attachment-id="{{ attachment.id }}">
                                <span class="attachment-name">{{ attachment.original_filename }}</span>
                                <div class="attachment-actions">
                                    <a href="{{ attachment.file.url }}" target="_blank" class="attachment-link">View</a>
                                    <button type="button" class="attachment-delete" onclick="deleteAttachment({{ attachment.id }})">Delete</button>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-attachments-message">No attachments uploaded yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group full-width">
            <label for="{{ form.triage_notes.id_for_label }}">Triage Notes</label>
            {{ form.triage_notes }}
            {% if form.triage_notes.errors %}
                <div class="error-message">{{ form.triage_notes.errors }}</div>
            {% endif %}
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group full-width">
            <label class="history-section-title">Triage Notes History</label>
            <div class="triage-notes-history" id="triageNotesHistory">
                {% if triage_notes_history %}
                    {% for history_item in triage_notes_history %}
                        <div class="history-item" data-timestamp="{{ history_item.submitted_at|date:'c' }}">
                            <div class="history-header">
                                <span class="history-author">{{ history_item.submitted_by.get_full_name|default:history_item.submitted_by.username }}</span>
                                <span class="history-timestamp" data-utc="{{ history_item.submitted_at|date:'c' }}">{{ history_item.submitted_at|date:"M d, Y H:i:s" }}</span>
                            </div>
                            <div class="history-content">{{ history_item.notes|linebreaks }}</div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-history-message">No triage notes history available.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="form-actions">
        <button type="submit" class="btn-primary">Save Changes</button>
        <button type="button" class="btn-secondary" onclick="closeRequestModal()">Cancel</button>
    </div>
</form>

