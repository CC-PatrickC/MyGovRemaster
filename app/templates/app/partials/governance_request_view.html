<div class="request-view">
    <div class="form-row">
        <div class="form-group full-width">
            <h4 class="attachments-section-title">Title</h4>
            <div class="request-view-value">{{ request_obj.title }}</div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group full-width">
            <h4 class="attachments-section-title">Description</h4>
            <div class="request-view-value">{{ request_obj.description|linebreaks }}</div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <h4 class="attachments-section-title">Department</h4>
            <div class="request-view-value">{{ request_obj.department|default:"(empty)" }}</div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <h4 class="attachments-section-title">Stage</h4>
            <div class="request-view-value">{{ request_obj.get_stage_display|default:request_obj.stage }}</div>
        </div>
        
        <div class="form-group">
            <h4 class="attachments-section-title">Request Type</h4>
            <div class="request-view-value">{{ request_obj.get_request_type_display|default:request_obj.request_type }}</div>
        </div>
        
        <div class="form-group">
            <h4 class="attachments-section-title">Priority</h4>
            <div class="request-view-value">{{ request_obj.get_priority_display|default:request_obj.priority }}</div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group full-width">
            <h4 class="attachments-section-title">Current Attachments</h4>
            <div class="attachments-list">
                {% if attachments %}
                    {% for attachment in attachments %}
                        <div class="attachment-item">
                            <span class="attachment-name">{{ attachment.original_filename }}</span>
                            <div class="attachment-actions">
                                <a href="{{ attachment.file.url }}" target="_blank" class="attachment-link">View</a>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-attachments-message">No attachments uploaded yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group full-width">
            <h4 class="attachments-section-title">Triage Notes</h4>
            <div class="request-view-value">{{ request_obj.triage_notes|linebreaks|default:"(empty)" }}</div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group full-width">
            <h4 class="attachments-section-title">Triage Notes History</h4>
            <div class="triage-notes-history" id="triageNotesHistory">
                {% if triage_notes_history %}
                    {% for history_item in triage_notes_history %}
                        <div class="history-item" data-timestamp="{{ history_item.submitted_at|date:'c' }}">
                            <div class="history-header">
                                <span class="history-author">{{ history_item.submitted_by.get_full_name|default:history_item.submitted_by.username }}</span>
                                <span class="history-timestamp" data-utc="{{ history_item.submitted_at|date:'c' }}">{{ history_item.submitted_at|date:"M d, Y H:i:s" }}</span>
                            </div>
                            <div class="history-content">{{ history_item.notes|linebreaks }}</div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-history-message">No triage notes history available.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group full-width">
            <h4 class="attachments-section-title">Triage Change History</h4>
            <div class="change-history" id="changeHistory">
                {% if change_history %}
                    {% for change in change_history %}
                        <div class="change-item" data-timestamp="{{ change.changed_at|date:'c' }}">
                            <div class="change-header">
                                <span class="change-author">{{ change.changed_by.get_full_name|default:change.changed_by.username }}</span>
                                <span class="change-timestamp" data-utc="{{ change.changed_at|date:'c' }}">{{ change.changed_at|date:"M d, Y H:i:s" }}</span>
                            </div>
                            <div class="change-details">
                                <div class="change-field-name">{{ change.field_name }}</div>
                                <div class="change-values">
                                    <div class="change-old">
                                        <span class="change-label">From:</span>
                                        <span class="change-value">{{ change.old_value|default:"(empty)" }}</span>
                                    </div>
                                    <div class="change-arrow">â†’</div>
                                    <div class="change-new">
                                        <span class="change-label">To:</span>
                                        <span class="change-value">{{ change.new_value|default:"(empty)" }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="no-history-message">No change history available.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

